# HDR视频闪烁初步

​	LDR视频到HDR视频，如果仅仅对LDR视频的每一帧使用反色调映射算法，会产生视频连续帧之间发生整体亮度突变的问题。对此我们的实验使用了论文*一种改进图像色貌模型的高动态范围视频色调映射新方法* 中提出的*亮度均值调整*的方法，来改善视频帧间的闪烁情况。

​	亮度均值调整算法的思想是：结合之前几帧亮度的均值来调整当前帧的亮度。使得同一场景中，帧与帧之间亮度差值维持在*人眼不可察觉的最大闪烁亮度差*之间，改善转换之后视频闪烁的问题。

​	具体算法如下：

1. 前5帧直接进行反色调映射操作，计算并保存每帧的平均亮度值 $L_i ，i=1，2，3，4，5$;
2. 处理第n帧前，计算此前5帧的平均亮度$L_{n avg} = \frac{1}{5}\sum^{n-1}_{i =n-5}L_i$
3. 对第n帧进行反色调映射操作，并计算得到HDR帧的平均亮度值$L_{n0}$
4. 如果$|L_{n0}- L_{navg}| \leq \varepsilon _{L}$，其中$\varepsilon _{L}$ 表示人眼不可察觉最大闪烁亮度差，根据实验可以得到其为大小为$L_{navg}$的2%，则不对该帧亮度进行调整，转到步骤(2)继续处理下一帧。
5. 如果$|L_{n0}- L_{navg}| \geq \varepsilon _{H}$，其中$\varepsilon _{H}$表示判断场景改变的的依据，根据实验可以得到其为大小为$L_{navg}$的10%，则视频进入了新的场景，不对该帧进行处理，转到步骤(1)，初始化。
6. 如果$\varepsilon _{L} < |L_{n0}- L_{navg}| < \varepsilon _{H}$，则代表在同一场景中发生了闪烁现象，调整该帧的亮度值得到$L_{n1}$，$|L_{n1}- L_{navg}| \leq \varepsilon _{L}$，转到步骤(2)继续处理下一帧。

